local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")

local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "CooldownChangerGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true

local blur = Instance.new("BlurEffect")
blur.Size = 10
blur.Parent = Lighting

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 350, 0, 290)
Frame.Position = UDim2.new(0, 100, 0, 100)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BackgroundTransparency = 0.3
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.ZIndex = 5
Frame.Parent = ScreenGui

local Corner = Instance.new("UICorner", Frame)
Corner.CornerRadius = UDim.new(0, 10)

local Shadow = Instance.new("ImageLabel")
Shadow.Size = UDim2.new(1, 24, 1, 24)
Shadow.Position = UDim2.new(0, -12, 0, -12)
Shadow.BackgroundTransparency = 1
Shadow.Image = "rbxassetid://1316045217"
Shadow.ImageTransparency = 0.85
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(10, 10, 118, 118)
Shadow.ZIndex = 4
Shadow.Parent = Frame

local Header = Instance.new("TextLabel")
Header.Size = UDim2.new(1, -60, 0, 40)
Header.Position = UDim2.new(0, 10, 0, 0)
Header.BackgroundTransparency = 1
Header.Text = "Passive Cooldown Editor"
Header.TextColor3 = Color3.fromRGB(255, 255, 255)
Header.Font = Enum.Font.GothamBold
Header.TextSize = 20
Header.TextXAlignment = Enum.TextXAlignment.Left
Header.ZIndex = 6
Header.Parent = Frame

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.Text = "X"
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseBtn.TextColor3 = Color3.new(1, 1, 1)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 14
CloseBtn.BorderSizePixel = 0
CloseBtn.ZIndex = 6
CloseBtn.Parent = Frame

local CloseCorner = Instance.new("UICorner", CloseBtn)
CloseCorner.CornerRadius = UDim.new(1, 0)

local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 30, 0, 30)
MinBtn.Position = UDim2.new(1, -70, 0, 5)
MinBtn.Text = "_"
MinBtn.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
MinBtn.TextColor3 = Color3.new(1, 1, 1)
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 18
MinBtn.BorderSizePixel = 0
MinBtn.ZIndex = 6
MinBtn.Parent = Frame

local MinCorner = Instance.new("UICorner", MinBtn)
MinCorner.CornerRadius = UDim.new(1, 0)

local function createLabeledInput(labelText, yPosition)
	local Label = Instance.new("TextLabel")
	Label.Size = UDim2.new(1, -40, 0, 20)
	Label.Position = UDim2.new(0, 20, 0, yPosition)
	Label.BackgroundTransparency = 1
	Label.Text = labelText
	Label.TextColor3 = Color3.fromRGB(200, 200, 200)
	Label.Font = Enum.Font.Gotham
	Label.TextSize = 14
	Label.TextXAlignment = Enum.TextXAlignment.Left
	Label.ZIndex = 6
	Label.Parent = Frame

	local TextBox = Instance.new("TextBox")
	TextBox.Size = UDim2.new(1, -40, 0, 30)
	TextBox.Position = UDim2.new(0, 20, 0, yPosition + 22)
	TextBox.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
	TextBox.BackgroundTransparency = 0.1
	TextBox.TextColor3 = Color3.new(0, 0, 0)
	TextBox.Font = Enum.Font.Gotham
	TextBox.TextSize = 14
	TextBox.BorderSizePixel = 0
	TextBox.ZIndex = 6
	TextBox.Parent = Frame

	local Corner = Instance.new("UICorner", TextBox)
	Corner.CornerRadius = UDim.new(0, 6)

	return TextBox
end

local PetNameBox = createLabeledInput("Pet Name", 50)
local PetAgeBox = createLabeledInput("Pet Age", 100)
local CooldownBox = createLabeledInput("Cooldown (e.g. 14:50)", 150)

local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0.48, -5, 0, 35)
Button.Position = UDim2.new(0, 20, 0, 215)
Button.Text = "Apply Cooldown"
Button.BackgroundColor3 = Color3.fromRGB(50, 150, 100)
Button.BackgroundTransparency = 0.1
Button.TextColor3 = Color3.new(1, 1, 1)
Button.TextSize = 14
Button.Font = Enum.Font.GothamBold
Button.BorderSizePixel = 0
Button.ZIndex = 6
Button.Parent = Frame

local ButtonCorner = Instance.new("UICorner", Button)
ButtonCorner.CornerRadius = UDim.new(0, 6)

local FreezeBtn = Instance.new("TextButton")
FreezeBtn.Size = UDim2.new(0.48, -5, 0, 35)
FreezeBtn.Position = UDim2.new(0.52, 5, 0, 215)
FreezeBtn.Text = "ðŸ§Š Freeze Time"
FreezeBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
FreezeBtn.BackgroundTransparency = 0.1
FreezeBtn.TextColor3 = Color3.new(1, 1, 1)
FreezeBtn.TextSize = 14
FreezeBtn.Font = Enum.Font.GothamBold
FreezeBtn.BorderSizePixel = 0
FreezeBtn.ZIndex = 6
FreezeBtn.Parent = Frame

local FreezeBtnCorner = Instance.new("UICorner", FreezeBtn)
FreezeBtnCorner.CornerRadius = UDim.new(0, 6)

local ProgressBarBG = Instance.new("Frame")
ProgressBarBG.Size = UDim2.new(1, -40, 0, 20)
ProgressBarBG.Position = UDim2.new(0, 20, 0, 255)
ProgressBarBG.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
ProgressBarBG.BackgroundTransparency = 0.2
ProgressBarBG.BorderSizePixel = 0
ProgressBarBG.ZIndex = 6
ProgressBarBG.Parent = Frame

local ProgressBarCorner = Instance.new("UICorner", ProgressBarBG)
ProgressBarCorner.CornerRadius = UDim.new(0, 6)

local ProgressFill = Instance.new("Frame")
ProgressFill.Size = UDim2.new(0, 0, 1, 0)
ProgressFill.BackgroundColor3 = Color3.fromRGB(50, 200, 120)
ProgressFill.BorderSizePixel = 0
ProgressFill.ZIndex = 6
ProgressFill.Parent = ProgressBarBG

local FillCorner = Instance.new("UICorner", ProgressFill)
FillCorner.CornerRadius = UDim.new(0, 6)

local PercentLabel = Instance.new("TextLabel")
PercentLabel.Size = UDim2.new(1, 0, 1, 0)
PercentLabel.Position = UDim2.new(0, 0, 0, 0)
PercentLabel.BackgroundTransparency = 1
PercentLabel.Text = "0%"
PercentLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
PercentLabel.Font = Enum.Font.Gotham
PercentLabel.TextSize = 13
PercentLabel.TextXAlignment = Enum.TextXAlignment.Center
PercentLabel.ZIndex = 7
PercentLabel.Parent = ProgressBarBG

local Credit = Instance.new("TextLabel")
Credit.Size = UDim2.new(1, -20, 0, 20)
Credit.Position = UDim2.new(0, 10, 1, -25)
Credit.BackgroundTransparency = 1
Credit.Text = "by @bam-i"
Credit.TextColor3 = Color3.fromRGB(180, 180, 180)
Credit.Font = Enum.Font.Gotham
Credit.TextSize = 13
Credit.TextXAlignment = Enum.TextXAlignment.Right
Credit.ZIndex = 6
Credit.Parent = Frame

Button.MouseEnter:Connect(function()
	Button.BackgroundColor3 = Color3.fromRGB(40, 130, 90)
end)
Button.MouseLeave:Connect(function()
	Button.BackgroundColor3 = Color3.fromRGB(50, 150, 100)
end)

FreezeBtn.MouseEnter:Connect(function()
	FreezeBtn.BackgroundColor3 = Color3.fromRGB(60, 110, 160)
end)
FreezeBtn.MouseLeave:Connect(function()
	FreezeBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
end)

-- Cooldown Logic - FREEZE TIME VERSION
local userCooldown = nil
local frozenLabels = {}
local connections = {}
local freezeEnabled = false

local function freezeLabel(label)
	if frozenLabels[label] then return end
	
	frozenLabels[label] = true
	local after = label.Text:match("m(.*)") or ""
	local frozenText = "Every " .. userCooldown .. "m" .. after
	
	-- Set initial frozen text
	label.Text = frozenText
	
	-- Create connection to constantly maintain the frozen time
	local connection = label:GetPropertyChangedSignal("Text"):Connect(function()
		-- Only freeze if freeze is enabled
		if freezeEnabled and label.Text ~= frozenText then
			label.Text = frozenText
		end
	end)
	
	connections[label] = connection
	
	-- Clean up when label is destroyed
	label.AncestryChanged:Connect(function()
		if not label.Parent then
			frozenLabels[label] = nil
			if connections[label] then
				connections[label]:Disconnect()
				connections[label] = nil
			end
		end
	end)
end

-- Main cooldown loop
task.spawn(function()
	while true do
		if userCooldown and freezeEnabled then
			-- Find all cooldown labels and freeze them
			for _, v in ipairs(game:GetDescendants()) do
				if v:IsA("TextLabel") and v.Text:find("^Every%s%d+:%d+m") and not frozenLabels[v] then
					freezeLabel(v)
				end
			end
			
			-- Also continuously force all known labels to stay frozen
			for label, _ in pairs(frozenLabels) do
				if label.Parent then
					local after = label.Text:match("m(.*)") or ""
					local expectedText = "Every " .. userCooldown .. "m" .. after
					if label.Text ~= expectedText then
						label.Text = expectedText
					end
				end
			end
		elseif userCooldown and not freezeEnabled then
			-- Just set the time once without freezing
			for _, v in ipairs(game:GetDescendants()) do
				if v:IsA("TextLabel") and v.Text:find("^Every%s%d+:%d+m") and not v.Text:find("Every " .. userCooldown .. "m") then
					local after = v.Text:match("m(.*)") or ""
					v.Text = "Every " .. userCooldown .. "m" .. after
				end
			end
		end
		task.wait(freezeEnabled and 0.1 or 2) -- Fast update when freezing, slow when not
	end
end)

-- Apply Cooldown with Progress
Button.MouseButton1Click:Connect(function()
	local text = CooldownBox.Text
	if text and #text > 0 then
		local duration = 5
		local startTime = tick()
		
		-- Reset progress bar
		ProgressFill.Size = UDim2.new(0, 0, 1, 0)
		PercentLabel.Text = "0%"
		
		-- Disable button during progress
		Button.Text = "Applying..."
		Button.TextColor3 = Color3.fromRGB(200, 200, 200)

		task.spawn(function()
			while true do
				local elapsed = tick() - startTime
				local percent = math.clamp((elapsed / duration) * 100, 0, 100)

				ProgressFill.Size = UDim2.new(percent / 100, 0, 1, 0)
				PercentLabel.Text = string.format("%d%%", percent)

				if percent >= 100 then
					userCooldown = text
					Button.Text = "Cooldown Applied!"
					Button.TextColor3 = Color3.fromRGB(100, 255, 150)
					
					-- Reset button after 2 seconds
					task.wait(2)
					Button.Text = "Apply Cooldown"
					Button.TextColor3 = Color3.new(1, 1, 1)
					break
				end
				task.wait(0.1)
			end
		end)
	end
end)

-- Freeze Toggle Button Click
FreezeBtn.MouseButton1Click:Connect(function()
	freezeEnabled = not freezeEnabled
	
	if freezeEnabled then
		FreezeBtn.Text = "ðŸ§Š FROZEN"
		FreezeBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
	else
		FreezeBtn.Text = "ðŸ§Š Freeze Time"
		FreezeBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
		
		-- Clear all frozen labels to allow normal countdown
		for label, _ in pairs(frozenLabels) do
			frozenLabels[label] = nil
		end
		for label, connection in pairs(connections) do
			connection:Disconnect()
		end
		connections = {}
	end
end)

-- Close + Minimize
CloseBtn.MouseButton1Click:Connect(function()
	blur:Destroy()
	ScreenGui:Destroy()
end)

MinBtn.MouseButton1Click:Connect(function()
	Frame.Visible = false
	blur.Enabled = false

	local ReopenBtn = Instance.new("TextButton")
	ReopenBtn.Size = UDim2.new(0, 160, 0, 30)
	ReopenBtn.Position = UDim2.new(0, 20, 0, 80)
	ReopenBtn.Text = "Open Cooldown Editor"
	ReopenBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	ReopenBtn.TextColor3 = Color3.new(1, 1, 1)
	ReopenBtn.Font = Enum.Font.Gotham
	ReopenBtn.TextSize = 14
	ReopenBtn.ZIndex = 10
	ReopenBtn.Parent = ScreenGui

	local reopenCorner = Instance.new("UICorner", ReopenBtn)
	reopenCorner.CornerRadius = UDim.new(0, 6)

	ReopenBtn.MouseButton1Click:Connect(function()
		Frame.Visible = true
		blur.Enabled = true
		ReopenBtn:Destroy()
	end)
end)
